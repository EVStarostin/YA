# YANDEX SHRI 2018 (Старостин Евгений Валерьевич)

### 8. ДЗ - «Архитектура»
**Сайт доступен по ссылке (gh-pages + кастомный домен):**  
http://www.evstar.ru/

## Запуск
Сборка с использованием Webpack. Для компиляции TypeScript используется ts-loader.  
`npm run build` - собрать проект  
`npm run start` - запустить локальный сервер  
`npm run test` - запустить тесты для фрейморка 

### Структура проекта:
**./packages/flux** - фреймворк  
**./public** - верстка + картинки + собранные css и js бандлы  
**./src/components** - css стили и js код компонентов  
**./src/models** - интерфейсы объектов  
**./src/store** - инициализация Store + Actions + Reducers  

### Описание
**API фрейморка**
```javascript
import { createStore } from "flux";

// Создание Store, хранящего состояние приложения
// Его API { dispatch, getState, subscribe, unsubscribe }.
const store = createStore(reducer, initialState); // инициализация Store
store.dispatch({ type: 'INCREMENT' }); // передача действия
const state = store.getState(); // получение текущего состояния Store
store.subscribe(callback); // подписаться на изменение состояния
store.unsubscribe(callback); // отписаться от изменения состояния

// Reducer - чистая функция, которая описывает, как Action превращает текущее состояние в новое.
// State изменять нельзя, Reducer должен возвращать новое состояние
function reducer(state, action) {
  switch (action.type) {
    case 'INCREMENT':
      return state + 1
    default:
      return state
  }
}
```

**Использование**  
Я использовал написанный фреймворк для двух сценариев работы приложения: 
1. **Переходы между страницами, сохранение последней открытой страницы**.  
При запуске приложения отправляется запрос к серверу за последним состоянием приложения, после чего данные сохраняются в store. В зависимости от значения в store поля *page* — открывается страница "События" или "Видеонаблюдение". При клике на одну из этих страниц диспатчится экшен `{ type: "CHANGE_PAGE", payload: page }`, текущая страница сохраняется в store и уходит на сервер.  
В рамках ДЗ по архитектуре добавил на серрвер новый роут для сохранения/загрузки данных из Store:  
- GET /api/state - получить состояние  
- POST /api/state - сохранить состояние  
2. **Получение списка событий**.  
При открытии страницы "События" уходит запрос на получение списка событий и при положительном исходе диспатчится экшен `{ type: "FETCH_EVENTS_SUCCESS", payload: events}`, события кладутся в store. В случае ошибки в ходе запроса диспатчится экшен `{ type: "FETCH_EVENTS_FAIL"}` и в store кладется описание ошибки.  
